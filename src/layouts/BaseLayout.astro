---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title?: string;
  description?: string;
  lang?: 'fr' | 'en' | 'de' | 'pt';
  canonical?: string;
}
const { title = 'Alexis Fiska', description = '', lang = 'fr', canonical } = Astro.props as Props;

const SITE_FALLBACK = 'https://taoxadmin.github.io';
const siteOrigin = (Astro.site?.origin ?? SITE_FALLBACK);
const currentPath = Astro.url?.pathname ?? '/';
const canonicalUrl = canonical ?? new URL(currentPath, siteOrigin).toString();

const BASE = import.meta.env.BASE_URL ?? '/';

const structuredData = [
  {
    '@context': 'https://schema.org',
    '@type': 'Person',
    name: 'Alexis Fiska',
    jobTitle: 'Lead QA Automation & GenAI',
    url: canonicalUrl,
    image: `${BASE}images/profile.jpg`,
    areaServed: 'France/Remote',
    worksFor: { '@type': 'Organization', name: 'Independent Consultant' },
    priceRange: '€€€',
    offers: {
      '@type': 'Offer',
      'priceCurrency': 'EUR',
      priceSpecification: { '@type': 'PriceSpecification', minPrice: 450, priceCurrency: 'EUR' }
    }
  },
  {
    '@context': 'https://schema.org',
    '@type': 'Service',
    name: 'QA Automation & GenAI consulting',
    provider: { '@type': 'Person', name: 'Alexis Fiska' },
    areaServed: 'France/Remote',
    priceRange: '€€€',
    offers: {
      '@type': 'Offer',
      'priceCurrency': 'EUR',
      priceSpecification: { '@type': 'PriceSpecification', minPrice: 450, priceCurrency: 'EUR' }
    }
  }
];
---
<!DOCTYPE html>
<html lang={lang} class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />

    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    <link rel="canonical" href={canonicalUrl} />

    <meta name="theme-color" content="#000000" />

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Alexis Fiska Portfolio" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    {description && <meta property="og:description" content={description} />}
    <meta property="og:image" content={`${BASE}images/placeholder_light_gray_block.png`} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    {description && <meta name="twitter:description" content={description} />}

    <link rel="icon" type="image/svg+xml" href={`${BASE}images/favicon.svg`} />

    <!-- Google Fonts: Inter (UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <script type="application/ld+json" is:inline set:html={JSON.stringify(structuredData)}></script>

    <script
      is:inline
      defer
      data-domain="taoxadmin.github.io"
      src="https://plausible.io/js/script.js"
    ></script>

    <!-- Styles page transitions (monochrome) -->
    <style is:inline>
      :root{
        --page-trans-dur: .28s;
        --page-trans-ease: cubic-bezier(.22,1,.36,1);
        --page-trans-shift: 10px;
      }
      @media (prefers-reduced-motion: reduce){
        .animate-page-in,.animate-page-out{ animation: none !important; }
      }
      @keyframes page-in {
        from { opacity: 0; transform: translateY(var(--page-trans-shift)); }
        to   { opacity: 1; transform: translateY(0); }
      }
      @keyframes page-out {
        from { opacity: 1; transform: translateY(0); }
        to   { opacity: 0; transform: translateY(var(--page-trans-shift)); }
      }
      .animate-page-in  { animation: page-in var(--page-trans-dur) var(--page-trans-ease) both; }
      .animate-page-out { animation: page-out var(--page-trans-dur) var(--page-trans-ease) both; }
		
		/* Fine grain overlay (site-wide) */
  .grain::before{
    content:"";
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;                 /* au-dessus des fonds, sous tes éléments high z-index */
    opacity: .09;              /* intensité du grain */
    mix-blend-mode: soft-light; /* rendu luxe sur fond sombre */
    background-repeat: repeat;
    background-size: 160px 160px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
  }
  /* Retina/4K : grain un poil plus fin */
  @media (min-resolution: 2dppx){
    .grain::before{
      background-size: 220px 220px;
      opacity: .04;
    }
  }
      /* Sélection de texte subtile en blanc translucide sur fond noir */
      ::selection { background: rgba(255,255,255,.16); color: #fff; }
    </style>
  </head>
  <body class="grain min-h-screen bg-black text-white flex flex-col font-sans">
    <a
      href="#main"
      class="sr-only focus:not-sr-only focus:absolute focus:top-2 focus:left-2
             bg-white text-black px-3 py-2 rounded z-50 focus:ring-2 ring-white/60"
    >
      Aller au contenu
    </a>

    <Header lang={lang} />

    <main id="main" data-page-trans class="container mx-auto px-4 py-8 flex-1 animate-page-in">
      <slot />
    </main>

    <Footer lang={lang} />

    <script is:inline>
      (function () {
        var DURATION = 280;
        var main = document.querySelector('main[data-page-trans]');
        if (!main) return;

        function isInternal(href) {
          try {
            var u = new URL(href, window.location.href);
            return u.origin === window.location.origin;
          } catch { return false; }
        }
        function findAnchor(el){
          while (el && el !== document.body){
            if (el.tagName && el.tagName.toLowerCase() === 'a') return el;
            el = el.parentElement;
          }
          return null;
        }
        document.addEventListener('click', function (e) {
          var a = findAnchor(e.target);
          if (!a) return;
          var href = a.getAttribute('href') || '';
          if (a.target === '_blank' || a.hasAttribute('download') || a.dataset.noTransition === 'true') return;
          if (!href || href[0] === '#' || href.startsWith('mailto:') || href.startsWith('tel:')) return;
          if (!isInternal(href)) return;

          e.preventDefault();
          if (document.body.classList.contains('page-exiting')) return;

          document.body.classList.add('page-exiting');
          main.classList.remove('animate-page-in');
          main.classList.add('animate-page-out');

          window.setTimeout(function(){
            window.location.href = a.href;
          }, DURATION);
        }, true);

        window.addEventListener('pageshow', function(){
          document.body.classList.remove('page-exiting');
          main.classList.remove('animate-page-out');
          main.classList.add('animate-page-in');
        });
      })();
    </script>
  </body>
</html>
