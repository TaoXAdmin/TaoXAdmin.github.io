---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';

const lang = 'pt';
const BASE = import.meta.env.BASE_URL ?? '/';

function stripLocale(s: string) {
  return s.replace(/\.(fr|en|de|pt)$/, '');
}

const all = await getCollection('blog');
const posts: CollectionEntry<'blog'>[] = all
  .filter((p) => p.data.locale === lang && !p.data.draft)
  .sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => b.data.date.getTime() - a.data.date.getTime());

const pageTitle = 'Blog - Alexis Fiska';
const pageDescription = 'Artigos t√©cnicos e notas de campo.';
---
<BaseLayout lang={lang} title={pageTitle} description={pageDescription}>
  <h1 class="text-3xl font-bold mb-6 text-center">Blog</h1>
  {posts.length === 0 ? (
    <p class="text-center text-neutral-600 dark:text-neutral-300">Os artigos chegam em breve.</p>
  ) : (
    <ul class="max-w-3xl mx-auto space-y-4">
      {posts.map((post: CollectionEntry<'blog'>) => (
        <li class="rounded-lg border border-neutral-200 dark:border-neutral-700 p-4 hover:bg-neutral-50 dark:hover:bg-neutral-800 transition">
          <a
            href={`${BASE}${lang}/blog/${stripLocale(post.slug)}`}
            class="text-lg font-semibold text-blue-600 dark:text-blue-400 hover:underline"
          >
            {post.data.title}
          </a>
          <p class="text-sm text-neutral-600 dark:text-neutral-300 mt-1">{post.data.description}</p>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
